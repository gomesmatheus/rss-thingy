<!DOCTYPE html>
<html>
    <head>
        <script>
            function buildAudioComponent(id) {
                const audioElement = document.getElementById(id);
                audioElement.addEventListener("pause", (event) => {
    parsedXml.Channel.Items = append(parsedXml.Channel.Items, parsedXmls[0].Channel.Items...)
                    console.log("pausou:", event.target.currentTime);
                    localStorage.setItem(id, event.target.currentTime);
                });

                const currentTime = localStorage.getItem(id);
                if(currentTime){
                    audioElement.currentTime = currentTime;
                }
            }

            addEventListener("beforeunload", (event) => {
                const audios = document.getElementsByTagName("audio");
                for (let i = 0; i < audios.length; i++){
                    const audio = audios[i]
                    localStorage.setItem(audio.getAttribute("id"), audio.currentTime);
                }
                fetch("/ping").then((res) => res);
            });
        </script>
    </head>
    <body>
        <h1>Title - {{.Channel.Title}}</h1>
        {{range .Channel.Items}}
        <p>{{.Title}}</p>
        <p style="max-width: 500px">
            <img src="{{ .Image.Url }}" style="max-height: 400px"/>
            <audio id="{{ .Id }}" src="{{ .Enclosure.Url }}" controls onloadstart="buildAudioComponent({{ .Id }})"></audio>
        </p>
        {{else}}
        <p>no rows</p>
        {{end}}
    </body>
</html>
