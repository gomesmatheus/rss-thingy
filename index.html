<!DOCTYPE html>
<html>
    <head>
        <script>
            function buildAudioComponent(id) {
                const audioElement = document.getElementById(id);
                audioElement.addEventListener("pause", (event) => {
                    console.log("pausou:", event.target.currentTime);
                    localStorage.setItem(id, event.target.currentTime);
                });

                const currentTime = localStorage.getItem(id);
                if(currentTime){
                    audioElement.currentTime = currentTime;
                }
            }

            addEventListener("beforeunload", (event) => {
                const audios = document.getElementsByTagName("audio");
                for (let i = 0; i < audios.length; i++){
                    const audio = audios[i]
                    localStorage.setItem(audio.getAttribute("id"), audio.currentTime);
                }
            });

            function isPageAtBottom() {
                const scrollTop = window.scrollY || window.pageYOffset;
                const scrollHeight = document.documentElement.scrollHeight;
                const clientHeight = document.documentElement.clientHeight;
                return (scrollTop + clientHeight + 200) >= scrollHeight;
            }

            window.addEventListener('scroll', function () {
                if (isPageAtBottom()) {
                    console.log("You have scrolled to the bottom of the page.");
                }
            });
        </script>
    </head>
    <body>
        <div id="main" style="display: flex;flex-direction: column;align-items: center;">
            {{range .}}
            <div>
                <p>{{.Title}} - {{.PodcastTitle}}</p>
                <p style="max-width: 500px">
                    <img src="{{ .Image.Url }}" style="max-height: 400px"/>
                    <audio id="{{ .Id }}" src="{{ .Enclosure.Url }}" controls onloadstart="buildAudioComponent({{ .Id }})"></audio>
                </p>
            </div>
            {{else}}
                <p>no rows</p>
            {{end}}
        </div>

    </body>
</html>
